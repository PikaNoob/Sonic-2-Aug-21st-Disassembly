name: Check bit-perfectness

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest

    steps:

      - uses: actions/checkout@v3

      - name: Assemble
        run: .\build.bat

      - name: Check if its bit-perfect
        run: |
          if (Test-Path -Path "s2built.bin") {
            $comparisonResult = Compare-Object -ReferenceObject (Get-Content -Path "s2built.bin" -Encoding Byte) -DifferenceObject (Get-Content -Path "sonic2alpha.bin" -Encoding Byte) -IncludeEqual -ExcludeDifferent
            if ($comparisonResult) {
            exit 1
            }
          } else {
            exit 1
          }
